name: test tokens-studio-data against spectrum-tokens (s2-colors)
on:
  pull_request:
    branches:
      - main
  workflow_dispatch:
jobs:
  ci:
    runs-on: ubuntu-latest
    steps:
      - run: echo "üéâ The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "üîé The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      - name: Check out tokens-studio-data code
        uses: actions/checkout@v4
        with:
          path: spectrum-tokens-studio-data
      - name: Check out spectrum-tokens code
        uses: actions/checkout@v4
        with:
          repository: mrcjhicks/spectrum-tokens
          path: spectrum-tokens
          ref: beta
      - name: Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: 18.13.x
      - name: try and run the diff script
        run: node spectrum-tokens-studio-data/.github/workflows/diff.js -test -source=./spectrum-tokens-studio-data/src/tokens-studio/spectrum2-colors/ -destination=./spectrum-tokens/packages/tokens/src/ >> $GITHUB_STEP_SUMMARY
      - name: append failure message
        if: failure()
        run: |
          gh pr comment ${{ github.event.number }} --body-file cout.log --repo ${{ github.repository}}
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
      - name: Upload change logs...
        if: ${{ hashFiles('./logs/*.json') != '' }}
        uses: actions/upload-artifact@v3
        with:
          name: changes
          path: ./logs/*.json
      - run: echo "üçè This job's status is ${{ job.status }}."